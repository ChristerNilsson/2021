// Generated by CoffeeScript 2.4.1
var Path;

Path = class Path {
  constructor(path1) {
    var j, len, ref, temp, x, x0, y, y0;
    this.path = path1;
    console.log('Path', this.path);
    if (this.path === "") {
      this.points = [];
      this.hash = 0;
      this.distance = 0;
      this.count = 0;
      this.box = null;
    } else {
      this.points = decodeAll(this.path);
      console.log("remove stand stills");
      //lastx = 0
      //lasty = 0
      temp = [this.points[0]];
      ref = this.points;
      for (j = 0, len = ref.length; j < len; j++) {
        [x, y] = ref[j];
        [x0, y0] = temp[temp.length - 1];
        if (x0 !== x || y0 !== y) {
          temp.push([x, y]);
        }
      }
      this.points = temp;
      console.log('points', this.points);
      this.hash = this.hashCode(this.path);
      console.log('hash', this.hash);
      this.distance = this.calcDist(); // in meters
      console.log('distance', this.distance);
      this.count = this.points.length;
      this.box = this.calcBox();
      console.log('box', this.box);
    }
  }

  calcDist() {
    var dx, dy, i, j, len, ref, res, x0, x1, y0, y1;
    res = 0;
    ref = range(1, this.points.length);
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      [x0, y0] = this.points[i - 1];
      [x1, y1] = this.points[i];
      dx = x0 - x1;
      dy = y0 - y1;
      res += Math.sqrt(dx * dx + dy * dy);
    }
    return Math.round(res);
  }

  calcBox() {
    var j, len, ref, x, xmax, xmin, y, ymax, ymin;
    [xmin, ymin] = this.points[0];
    [xmax, ymax] = this.points[0];
    ref = this.points;
    for (j = 0, len = ref.length; j < len; j++) {
      [x, y] = ref[j];
      if (x < xmin) {
        xmin = x;
      }
      if (x > xmax) {
        xmax = x;
      }
      if (y < ymin) {
        ymin = y;
      }
      if (y > ymax) {
        ymax = y;
      }
    }
    return [[xmin, ymin], [xmax, ymax]];
  }

  hashCode(path) {
    var hash, i, j, len, ref;
    hash = 0;
    ref = range(path.length);
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      hash = ((hash << 5) - hash) + path.charCodeAt(i);
    }
    return hash;
  }

  save() {
    var box, found, j, len;
    if (this.points.length === 0) {
      return;
    }
    found = false;
    this.path = encodeAll(this.points);
    this.hash = this.hashCode(this.path);
    this.box = this.calcBox();
    this.distance = this.calcDist();
    for (j = 0, len = boxes.length; j < len; j++) {
      box = boxes[j];
      if (box[0] === this.hash) {
        found = true;
      }
    }
    if (!found) {
      console.log('save', this.points, this.path, this.hash, this.box, this.distance);
      boxes.push([this.hash, this.box]);
      localStorage['boxes'] = JSON.stringify(boxes);
      return localStorage[this.hash] = this.path;
    }
  }

  delete() {
    var box, currentPath, i, j, len, ref, results;
    localStorage.removeItem(this.hash);
    ref = range(boxes.length);
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      box = boxes[i];
      if (box[0] === this.hash) {
        boxes.splice(i, 1);
        currentPath = null;
        results.push(localStorage['boxes'] = JSON.stringify(boxes));
      } else {
        results.push(void 0);
      }
    }
    return results;
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0aC5qcyIsInNvdXJjZVJvb3QiOiIuLiIsInNvdXJjZXMiOlsiY29mZmVlXFxwYXRoLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBQTs7QUFBTSxPQUFOLE1BQUEsS0FBQTtFQUNDLFdBQWMsTUFBQSxDQUFBO0FBQ2IsUUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLEVBQUE7SUFEYyxJQUFDLENBQUE7SUFDZixPQUFPLENBQUMsR0FBUixDQUFZLE1BQVosRUFBbUIsSUFBQyxDQUFBLElBQXBCO0lBQ0EsSUFBRyxJQUFDLENBQUEsSUFBRCxLQUFTLEVBQVo7TUFDQyxJQUFDLENBQUEsTUFBRCxHQUFVO01BQ1YsSUFBQyxDQUFBLElBQUQsR0FBUTtNQUNSLElBQUMsQ0FBQSxRQUFELEdBQVk7TUFDWixJQUFDLENBQUEsS0FBRCxHQUFTO01BQ1QsSUFBQyxDQUFBLEdBQUQsR0FBTyxLQUxSO0tBQUEsTUFBQTtNQU9DLElBQUMsQ0FBQSxNQUFELEdBQVUsU0FBQSxDQUFVLElBQUMsQ0FBQSxJQUFYO01BRVYsT0FBTyxDQUFDLEdBQVIsQ0FBWSxxQkFBWixFQUZBOzs7TUFLQSxJQUFBLEdBQU8sQ0FBQyxJQUFDLENBQUEsTUFBTyxDQUFBLENBQUEsQ0FBVDtBQUNQO01BQUEsS0FBQSxxQ0FBQTtRQUFJLENBQUMsQ0FBRCxFQUFHLENBQUg7UUFDSCxDQUFDLEVBQUQsRUFBSSxFQUFKLENBQUEsR0FBVSxJQUFLLENBQUEsSUFBSSxDQUFDLE1BQUwsR0FBWSxDQUFaO1FBQ2YsSUFBRyxFQUFBLEtBQUksQ0FBSixJQUFTLEVBQUEsS0FBSSxDQUFoQjtVQUF1QixJQUFJLENBQUMsSUFBTCxDQUFVLENBQUMsQ0FBRCxFQUFHLENBQUgsQ0FBVixFQUF2Qjs7TUFGRDtNQUdBLElBQUMsQ0FBQSxNQUFELEdBQVU7TUFFVixPQUFPLENBQUMsR0FBUixDQUFZLFFBQVosRUFB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WUFBYSxDQUFBLE9BQUEsQ0FBYixHQUF3QixJQUFJLENBQUMsU0FBTCxDQUFlLEtBQWYsR0FIekI7T0FBQSxNQUFBOzZCQUFBOztJQUZELENBQUE7O0VBRlE7O0FBdkVWIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgUGF0aFxyXG5cdGNvbnN0cnVjdG9yIDogKEBwYXRoKSAtPlxyXG5cdFx0Y29uc29sZS5sb2cgJ1BhdGgnLEBwYXRoXHJcblx0XHRpZiBAcGF0aCA9PSBcIlwiXHJcblx0XHRcdEBwb2ludHMgPSBbXVxyXG5cdFx0XHRAaGFzaCA9IDBcclxuXHRcdFx0QGRpc3RhbmNlID0gMFxyXG5cdFx0XHRAY291bnQgPSAwXHJcblx0XHRcdEBib3ggPSBudWxsXHJcblx0XHRlbHNlXHJcblx0XHRcdEBwb2ludHMgPSBkZWNvZGVBbGwgQHBhdGhcclxuXHJcblx0XHRcdGNvbnNvbGUubG9nIFwicmVtb3ZlIHN0YW5kIHN0aWxsc1wiXHJcblx0XHRcdCNsYXN0eCA9IDBcclxuXHRcdFx0I2xhc3R5ID0gMFxyXG5cdFx0XHR0ZW1wID0gW0Bwb2ludHNbMF1dXHJcblx0XHRcdGZvciBbeCx5XSBpbiBAcG9pbnRzXHJcblx0XHRcdFx0W3gwLHkwXSA9IHRlbXBbdGVtcC5sZW5ndGgtMV1cclxuXHRcdFx0XHRpZiB4MCE9eCBvciB5MCE9eSB0aGVuIHRlbXAucHVzaCBbeCx5XVxyXG5cdFx0XHRAcG9pbnRzID0gdGVtcFxyXG5cclxuXHRcdFx0Y29uc29sZS5sb2cgJ3BvaW50cycsQHBvaW50c1xyXG5cdFx0XHRAaGFzaCA9IEBoYXNoQ29kZSBAcGF0aFxyXG5cdFx0XHRjb25zb2xlLmxvZyAnaGFzaCcsQGhhc2hcclxuXHRcdFx0QGRpc3RhbmNlID0gQGNhbGNEaXN0KCkgIyBpbiBtZXRlcnNcclxuXHRcdFx0Y29uc29sZS5sb2cgJ2Rpc3RhbmNlJyxAZGlzdGFuY2VcclxuXHRcdFx0QGNvdW50ID0gQHBvaW50cy5sZW5ndGhcclxuXHRcdFx0QGJveCA9IEBjYWxjQm94KClcclxuXHRcdFx0Y29uc29sZS5sb2cgJ2JveCcsQGJveFxyXG5cclxuXHRjYWxjRGlzdCA6IC0+XHJcblx0XHRyZXMgPSAwXHJcblx0XHRmb3IgaSBpbiByYW5nZSAxLEBwb2ludHMubGVuZ3RoXHJcblx0XHRcdFt4MCx5MF0gPSBAcG9pbnRzW2ktMV1cclxuXHRcdFx0W3gxLHkxXSA9IEBwb2ludHNbaV1cclxuXHRcdFx0ZHggPSB4MC14MVxyXG5cdFx0XHRkeSA9IHkwLXkxXHJcblx0XHRcdHJlcyArPSBNYXRoLnNxcnQgZHgqZHgrZHkqZHlcclxuXHRcdE1hdGgucm91bmQgcmVzXHJcblxyXG5cdGNhbGNCb3ggOiAtPlxyXG5cdFx0W3htaW4seW1pbl0gPSBAcG9pbnRzWzBdXHJcblx0XHRbeG1heCx5bWF4XSA9IEBwb2ludHNbMF1cclxuXHRcdGZvciBbeCx5XSBpbiBAcG9pbnRzXHJcblx0XHRcdGlmIHggPCB4bWluIHRoZW4geG1pbiA9IHhcclxuXHRcdFx0aWYgeCA+IHhtYXggdGhlbiB4bWF4ID0geFxyXG5cdFx0XHRpZiB5IDwgeW1pbiB0aGVuIHltaW4gPSB5XHJcblx0XHRcdGlmIHkgPiB5bWF4IHRoZW4geW1heCA9IHlcclxuXHRcdFtbeG1pbix5bWluXSxbeG1heCx5bWF4XV1cclxuXHJcblx0aGFzaENvZGUgOiAocGF0aCkgLT5cclxuXHRcdGhhc2ggPSAwXHJcblx0XHRmb3IgaSBpbiByYW5nZSBwYXRoLmxlbmd0aFxyXG5cdFx0XHRoYXNoICA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgcGF0aC5jaGFyQ29kZUF0IGlcclxuXHRcdGhhc2hcclxuXHJcblx0c2F2ZSA6IC0+XHJcblx0XHRpZiBAcG9pbnRzLmxlbmd0aCA9PSAwIHRoZW4gcmV0dXJuXHJcblx0XHRmb3VuZCA9IGZhbHNlXHJcblx0XHRAcGF0aCA9IGVuY29kZUFsbCBAcG9pbnRzXHJcblx0XHRAaGFzaCA9IEBoYXNoQ29kZSBAcGF0aFxyXG5cdFx0QGJveCA9IEBjYWxjQm94KClcclxuXHRcdEBkaXN0YW5jZSA9IEBjYWxjRGlzdCgpXHJcblx0XHRmb3IgYm94IGluIGJveGVzXHJcblx0XHRcdGlmIGJveFswXSA9PSBAaGFzaCB0aGVuIGZvdW5kID0gdHJ1ZVxyXG5cdFx0aWYgbm90IGZvdW5kXHJcblx0XHRcdGNvbnNvbGUubG9nICdzYXZlJyxAcG9pbnRzLEBwYXRoLEBoYXNoLEBib3gsQGRpc3RhbmNlXHJcblx0XHRcdGJveGVzLnB1c2ggW0BoYXNoLEBib3hdXHJcblx0XHRcdGxvY2FsU3RvcmFnZVsnYm94ZXMnXSA9IEpTT04uc3RyaW5naWZ5IGJveGVzXHJcblx0XHRcdGxvY2FsU3RvcmFnZVtAaGFzaF0gPSBAcGF0aFxyXG5cdFxyXG5cdGRlbGV0ZSA6IC0+XHJcblx0XHRsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSBAaGFzaFxyXG5cdFx0Zm9yIGkgaW4gcmFuZ2UgYm94ZXMubGVuZ3RoXHJcblx0XHRcdGJveCA9IGJveGVzW2ldXHJcblx0XHRcdGlmIGJveFswXSA9PSBAaGFzaFxyXG5cdFx0XHRcdGJveGVzLnNwbGljZSBpLDFcclxuXHRcdFx0XHRjdXJyZW50UGF0aCA9IG51bGxcclxuXHRcdFx0XHRsb2NhbFN0b3JhZ2VbJ2JveGVzJ10gPSBKU09OLnN0cmluZ2lmeSBib3hlc1xyXG4iXX0=
//# sourceURL=c:\github\2021\013-gpsKarta2\coffee\path.coffee